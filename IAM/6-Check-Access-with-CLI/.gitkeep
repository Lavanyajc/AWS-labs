
✅ Lab: Check Access via CLI after Denying EC2 Permissions

🔸 Goal:
Restrict EC2 actions using a Deny policy and verify access via AWS CLI.

✅ Steps Performed:

1. Initial Setup:
- Launched an EC2 instance via AWS Console (Amazon Linux).
- Verified instance is in "running" state.

2. Created IAM User (ec2cliuser)
- Enabled programmatic access.
- Configured access keys in AWS CLI using:
  aws configure

3. Verified EC2 Describe Access Initially:
- Ran:
  aws ec2 describe-instances
- ✅ Output: Instance details fetched successfully.

4. Created Deny Policy for EC2:
- Created a policy `DenyEC2Actions` with the following JSON:
##'''json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyAllEC2Actions",
      "Effect": "Deny",
      "Action": "ec2:*",
      "Resource": "*"
    }
  ]
}
'''

5. Attached Deny Policy to User:
- Went to IAM → ec2cliuser → Add permissions → Attach policy → Selected `DenyEC2Actions`.

6. Verified Access After Deny:
- Ran:
  aws ec2 describe-instances
- ❌ Result: "AccessDenied" error appeared confirming deny policy in effect.

7. Detached Deny Policy:
- Detached `DenyEC2Actions` from the user via IAM Console.

8. Retested EC2 CLI Access:
- Ran:
  aws ec2 describe-instances
- ✅ Output: EC2 instance data returned successfully again.

🎯 Outcome:
Successfully tested the effect of a Deny policy on EC2 actions via CLI and verified its impact and reversal after detachment.


